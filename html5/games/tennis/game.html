<html>
<p>
  Check out this game!
</p>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
var canvas;
var canvasContext;
var leftPaddle;
var rightPaddle;
var gameOver = false;
const WINNING_SCORE = 3;

function calculateMousePosition(evt) {
  var rect = canvas.getBoundingClientRect();
  var root = document.documentElement;
  var mouseX = evt.clientX - rect.left - root.scrollLeft;
  var mouseY = evt.clientY - rect.top - root.scrollTop;

  return { x: mouseX, y: mouseY};
}

function colorRect(leftX, topY, width, height, color) {
  canvasContext.fillStyle = color;
  canvasContext.fillRect(leftX, topY, width, height, color);
}

function colorCircle(centerX, centerY, radius, drawColor) {
  canvasContext.fillStyle = drawColor;
  canvasContext.beginPath();
  canvasContext.arc(centerX, centerY, radius, 0, Math.PI * 2, true);
  canvasContext.fill();
}

function newPaddle(x) {
  return {
    score: 0,
    x: x,
    y: 250,
    width: 10,
    height: 100,
    color: 'white',
    draw: function() {
      colorRect(this.x, this.y, this.width, this.height, this.color);
    },

    auto: function() {
      if ((this.center() + 35) > ball.y) {
        this.y -= 6;
      } else if((this.center() - 35) < ball.y) {
        this.y += 6;
      }
    },

    bottom: function() {
      return this.y + this.height;
    },

    center: function() {
      return this.y + (this.height / 2);
    }
  }
}


var ball = {
  x: 400, // needs to be set away from the edge so it doesn't "bounce" off the
  y: 300, // screen.
  radius: 10,
  xSpeed: 5,
  ySpeed: 5,
  color: 'red',

  move: function() {

    if (ball.x <= ball.radius + leftPaddle.width) {
      // miss
      if(!(ball.y <= leftPaddle.y + leftPaddle.height && ball.y >= leftPaddle.y)) {
        this.reset(rightPaddle);
      } // hit
      // change angle of shot depending on where the ball hits the paddle
      ball.ySpeed = (ball.y - leftPaddle.center()) * .35;
      ball.xSpeed *= -1; // bounce off the left side
    }

    if(ball.x >= (canvas.width - ball.radius)) {
      // miss
      if(!(ball.y <= rightPaddle.y + rightPaddle.height && ball.y >= rightPaddle.y)) {
        this.reset(leftPaddle);
      } // hit
      // change angle of shot depending on where the ball hits the paddle
      ball.ySpeed = (ball.y - rightPaddle.center()) * .35;
      ball.xSpeed *= -1; //bounce off the right side
    }

    // bounce off the bottom and top
    if (ball.y >= (canvas.height - ball. radius) || ball.y <= ball.radius) {
      ball.ySpeed *= -1
    }

    this.x += ball.xSpeed;
    this.y += ball.ySpeed;
  },

  draw: function() {
    colorCircle(ball.x, ball.y, ball.radius, this.color);
  },

  reset: function(paddle) {
    paddle.score += 1;

    if(paddle.score >= WINNING_SCORE) {
      leftPaddle.score = 0;
      rightPaddle.score = 0;
      gameOver = true;
    }

    this.x = canvas.width / 2;
    this.y = canvas.height / 2;
  }
};

var background = {
  color: 'black',

  draw: function() {
    colorRect(0, 0, canvas.width, canvas.height, background.color);
  },

  drawNet: function() {
    for(var i = 0; i < canvas.height; i += 40) {
      colorRect(canvas.width / 2 - 1, i, 2, 20, 'white');
    }
  }
}

function gameReset() {
  if(gameOver){
    leftPaddle.score = 0;
    rightPaddle.score = 0;
    gameOver = false;
  }
}

window.onload = function() {
  canvas = document.getElementById('gameCanvas');
  canvasContext = canvas.getContext('2d');
  leftPaddle = newPaddle(0);
  rightPaddle = newPaddle(canvas.width - 10)

  var framesPerSecond = 30;

  setInterval(tick, 1000 / framesPerSecond);

  canvas.addEventListener('mouseclick', gameReset);

  canvas.addEventListener('mousemove',
          function(evt) {
            var mousePos = calculateMousePosition(evt);
            leftPaddle.y = mousePos.y - leftPaddle.height / 2;
          });
}

function tick() {
  move();
  draw();
}

function move() {
  ball.move();
  rightPaddle.auto();
}

function draw() {
  background.draw();
  background.drawNet();

  if (gameOver) {
    canvasContext.fillStyle = 'white';
    canvasContext.fillText("Click to Continue", 100, 100);
    return;
  }

  ball.draw();
  leftPaddle.draw();
  rightPaddle.draw();

  canvasContext.fillText(leftPaddle.score, 100, 100);
  canvasContext.fillText(rightPaddle.score, canvas.width - 100, 100)
}

</script>
</html>
